---
import BaseLayout from './BaseLayout.astro';
import GameInfo from '../components/GameInfo.astro';

interface GameInfoType {
  title: string;
  genre?: string[];
  platforms?: string[];
  releaseDate?: string;
  developer?: string;
  publisher?: string;
  developerCountry?: string;
  coverImage?: string;
  metascore?: number | null;
  userScore?: number | null;
  isAiInferred?: boolean;
  aiInferredFields?: string[];
}

interface Props {
  title: string;
  category: 'newRelease' | 'indie' | 'feature' | 'classic';
  summary: string;
  game?: GameInfoType;
  featureImage?: string; // 特集記事用のAI生成画像
  issueNumber?: number;
}

const { title, category, summary, game, featureImage, issueNumber } = Astro.props;

const categoryLabels: Record<string, string> = {
  newRelease: '新作紹介',
  indie: 'インディーゲーム',
  feature: '特集',
  classic: '名作深掘り',
};

const categoryColors: Record<string, string> = {
  newRelease: '#4fc3f7',
  indie: '#81c784',
  feature: '#ffb74d',
  classic: '#ba68c8',
};
---

<BaseLayout title={title}>
  <article class="article">
    <header class="article-header">
      <div class="container">
        {
          issueNumber && (
            <a href="/" class="back-link">
              &larr; Vol.{issueNumber} に戻る
            </a>
          )
        }
        <span
          class="category-badge"
          style={`--category-color: ${categoryColors[category]}`}
        >
          {categoryLabels[category]}
        </span>
        <h1 class="article-title">{title}</h1>
        <p class="article-summary">{summary}</p>
      </div>
    </header>

    {
      game && (
        <div class="game-info-section">
          <div class="container">
            <GameInfo
              title={game.title}
              genre={game.genre}
              platforms={game.platforms}
              releaseDate={game.releaseDate}
              developer={game.developer}
              publisher={game.publisher}
              developerCountry={game.developerCountry}
              coverImage={game.coverImage}
              metascore={game.metascore}
              userScore={game.userScore}
              isAiInferred={game.isAiInferred}
              aiInferredFields={game.aiInferredFields}
            />
          </div>
        </div>
      )
    }

    {
      featureImage && (
        <div class="feature-image-section">
          <div class="container">
            <div class="feature-image-wrapper">
              <img
                src={featureImage}
                alt={title}
                class="feature-image"
                loading="eager"
              />
              <div class="ai-badge">AI Generated</div>
            </div>
          </div>
        </div>
      )
    }

    <div class="article-content">
      <div class="container">
        <slot />
      </div>
    </div>
  </article>
</BaseLayout>

<style>
  .article {
    min-height: 100vh;
  }

  /* 詳細ページ用のワイドコンテナ */
  .article :global(.container) {
    max-width: 1600px;
    padding: 0 var(--spacing-md);
  }

  .article-header {
    background: linear-gradient(
      135deg,
      var(--color-accent) 0%,
      var(--color-secondary) 50%,
      var(--color-background) 100%
    );
    padding: var(--spacing-md) 0 var(--spacing-sm);
    position: relative;
    overflow: hidden;
  }

  /* 装飾的な背景パターン */
  .article-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(circle at 20% 80%, rgba(233, 69, 96, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(79, 195, 247, 0.1) 0%, transparent 40%);
    pointer-events: none;
  }

  .article-header .container {
    position: relative;
    z-index: 1;
  }

  .back-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--color-text-muted);
    font-size: 0.8rem;
    margin-bottom: var(--spacing-sm);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
  }

  .back-link:hover {
    color: var(--color-text);
    background: rgba(255, 255, 255, 0.1);
  }

  .category-badge {
    display: inline-block;
    background: var(--category-color);
    color: var(--color-background);
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-full);
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: var(--spacing-sm);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  }

  .article-title {
    font-size: 2rem;
    margin-bottom: var(--spacing-sm);
    line-height: 1.25;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }

  .article-summary {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.85);
    max-width: 1200px;
    margin: 0;
    line-height: 1.5;
  }

  .game-info-section {
    margin-bottom: var(--spacing-sm);
  }

  .feature-image-section {
    margin-bottom: var(--spacing-md);
  }

  .feature-image-wrapper {
    position: relative;
    border-radius: var(--radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
  }

  .feature-image {
    width: 100%;
    height: auto;
    display: block;
    aspect-ratio: 16 / 9;
    object-fit: cover;
  }

  .ai-badge {
    position: absolute;
    bottom: var(--spacing-sm);
    right: var(--spacing-sm);
    background: rgba(0, 0, 0, 0.7);
    color: var(--color-text-muted);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-sm);
    font-size: 0.7rem;
    font-weight: 500;
    letter-spacing: 0.05em;
    backdrop-filter: blur(4px);
  }

  .article-content {
    padding-bottom: var(--spacing-md);
  }

  @media (max-width: 768px) {
    .article :global(.container) {
      padding: 0 var(--spacing-sm);
    }

    .article-header {
      padding: var(--spacing-md) 0 var(--spacing-sm);
    }

    .article-title {
      font-size: 1.4rem;
    }

    .article-summary {
      font-size: 0.9rem;
    }
  }
</style>
